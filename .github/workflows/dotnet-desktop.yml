name: 发布.NET桌面程序

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:

  build:

    strategy:
      matrix:
        configuration: [Debug, Release]

    runs-on: windows-latest

    env:
      App_Name: Dictation
      Solution_Name: Dictation.sln                                                         # Replace with your solution name, i.e. MyWpfApp.sln.
      Project_Directory: Dictation.Presentation                                            # Replace with the Wap project directory relative to the solution, i.e. MyWpfApp.Package.
      Project_Path: Dictation.Presentation\Dictation.Presentation.csproj                   # Replace with the path to your Wap project, i.e. MyWpf.App.Package\MyWpfApp.Package.wapproj.

    steps:
    - name: 拉取代码
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: 安装.NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x

    - name: 安装MS Build
      uses: microsoft/setup-msbuild@v2

    - name: 还原依赖
      run: msbuild $env:Solution_Name /t:Restore /p:Configuration=$env:Configuration
      env:
        Configuration: ${{ matrix.configuration }}

    - name: 编译程序
      run: msbuild $env:Project_Path /p:Configuration=$env:Configuration /p:UapAppxPackageBuildMode=$env:Appx_Package_Build_Mode /p:AppxBundle=$env:Appx_Bundle
      env:
        Appx_Bundle: Always
        Appx_Bundle_Platforms: x86|x64
        Appx_Package_Build_Mode: StoreUpload
        Configuration: ${{ matrix.configuration }}

    - name: 创建 Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        body: TODO New Release.
        draft: false
        prerelease: false

    - name: 上传Release文件
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: ./${{ env.App_Name }}.zip
        asset_name: ${{ env.App_Name }}.zip
        asset_content_type: application/zip

        
    
